/**
 * Castle
 * Author ohmyga ( https://ohmyga.cn )
 * Github https://github.com/ohmyga233/castle-Typecho-Theme
 * Version 0.2.5
 **/

var CastleSetting=function(setting){if(setting.PJAX){$(document).on('submit','#search',function(event){$.pjax.submit(event,'#moe-body',{fragment:'#moe-body',timeout:PJAXtimeout})});$(document).pjax('a[href^="'+siteurl+'"]:not(a[target="_blank"], a[no-pjax])',{container:'#moe-body',fragment:'#moe-body',timeout:PJAXtimeout}).on('pjax:send',function(){beforePJAX()}).on('pjax:complete',function(){afterPJAX();if(setting.NightOrDay){checkNight()};lazyreload();commentsHS();headimgAJAX();Searchclose();checkLink();rmTooltip();checkLinks();scrollClick();bangumiNew();RLhighlight()})}if(setting.goTop){var scrolltotop={setting:{startline:100,scrollto:0,scrollduration:400,fadeduration:[500,100]},controlHTML:'<button class="mdui-fab mdui-ripple mdui-color-theme-accent"><i class="mdui-icon material-icons">arrow_upward</i></button>',controlattrs:{offsetx:0,offsety:0},anchorkeyword:"#top",state:{isvisible:false,shouldvisible:false},scrollup:function(){if(!this.cssfixedsupport){this.$control.css({opacity:0})}var dest=isNaN(this.setting.scrollto)?this.setting.scrollto:parseInt(this.setting.scrollto);if(typeof dest=="string"&&jQuery("#"+dest).length==1){dest=jQuery("#"+dest).offset().top}else{dest=0}this.$body.animate({scrollTop:dest},this.setting.scrollduration)},keepfixed:function(){var $window=jQuery(window);var controlx=$window.scrollLeft()+$window.width()-this.$control.width()-this.controlattrs.offsetx;var controly=$window.scrollTop()+$window.height()-this.$control.height()-this.controlattrs.offsety;this.$control.css({left:controlx+"px",top:controly+"px"})},togglecontrol:function(){var scrolltop=jQuery(window).scrollTop();if(!this.cssfixedsupport){this.keepfixed()}this.state.shouldvisible=(scrolltop>=this.setting.startline)?true:false;if(this.state.shouldvisible&&!this.state.isvisible){this.$control.stop().animate({opacity:1},this.setting.fadeduration[0]);this.state.isvisible=true}else{if(this.state.shouldvisible==false&&this.state.isvisible){this.$control.stop().animate({opacity:0},this.setting.fadeduration[1]);this.state.isvisible=false}}},init:function(){jQuery(document).ready(function($){var mainobj=scrolltotop;var iebrws=document.all;mainobj.cssfixedsupport=!iebrws||iebrws&&document.compatMode=="CSS1Compat"&&window.XMLHttpRequest;mainobj.$body=(window.opera)?(document.compatMode=="CSS1Compat"?$("html"):$("body")):$("html,body");mainobj.$control=$('<div id="topcontrol" >'+mainobj.controlHTML+"</div>").css({position:mainobj.cssfixedsupport?"fixed":"absolute",bottom:"5em",right:"1em",opacity:0,cursor:"pointer"}).attr({title:topText}).click(function(){mainobj.scrollup();return false}).appendTo("body");if(document.all&&!window.XMLHttpRequest&&mainobj.$control.text()!=""){mainobj.$control.css({width:mainobj.$control.width()})}mainobj.togglecontrol();$('a[href="'+mainobj.anchorkeyword+'"]').click(function(){mainobj.scrollup();return false});$(window).bind("scroll resize",function(e){mainobj.togglecontrol()})})}};scrolltotop.init()}if(setting.title){(function(){var tieleIcon=document.getElementById("Icon-title");var OriginTitile=document.title,titleTime;document.addEventListener('visibilitychange',function(){if(document.hidden){document.title=leaveTitle;clearTimeout(titleTime);tieleIcon.href=leaveIcon;tieleIcon.type='image/x-icon'}else{document.title=returnTitle;tieleIcon.href=returnIcon;tieleIcon.type='image/x-icon';titleTime=setTimeout(function(){document.title=OriginTitile;tieleIcon.href=OriginIcon;tieleIcon.type='image/x-icon'},2000)}})})()}if(setting.copyPrompt){document.body.oncopy=function(){mdui.alert(copyPromptText,copyPromptTitle)}}if(setting.commentAJAX){window.commentSubmit=function(){var cbbID=document.getElementById('commentSuBt');cbbID.innerHTML='cached';$('#commentsSuBtt').attr("disabled",true);$("#commentSuBt").addClass("moe-comments-submit-loading");$(".mdui-tooltip").removeClass("mdui-tooltip-open");var data=$("#commentsSubmit-Form").serialize();$.ajax({type:"POST",url:commentUrl,data:data,success:function(back){var backC=back;var $$=mdui.JQ;var Obj=$("<body></body>").append($(backC));var $html=$(".container",Obj);if($html.html()==null){if(setting.PJAX){$.pjax.reload({container:'#moe-body',fragment:'#moe-body',timeout:PJAXtimeout})}else{$("#comments").load(location.href+" #comments");lazyreload()}cbbID.innerHTML='send';$("#commentSuBt").removeClass("moe-comments-submit-loading");$('#commentsSuBtt').attr("disabled",false);mdui.snackbar({message:'评论成功！',position:'right-bottom'})}else{cbbID.innerHTML='warning';$("#commentSuBt").removeClass("moe-comments-submit-loading");$('#commentsSuBtt').attr("disabled",false);setTimeout(function(){$("#commentSuBt").addClass("moe-card-a");cbbID.innerHTML='send';$("#commentSuBt").removeClass("moe-card-a")},2*1000);mdui.snackbar({message:$html.html(),position:'right-bottom'})}}})}}if(setting.textareaHTML){var textarea=$('textarea[id=moe-comments-pl]');var html=textarea.val();textarea.val($(html).text())}if(setting.NightOrDay){window.NightSwitchON=function(){$('body').addClass('mdui-theme-layout-dark');var Days=30;var exp=new Date();exp.setTime(exp.getTime()+Days*24*60*60*1000);document.cookie="nightSwitch=open;expires="+exp.toGMTString()+";path=/";document.getElementById('nightText').innerHTML='brightness_high';$('#nightBtn').attr('mdui-tooltip',"{content: '切换到日间模式'}");$('#nightBtn').removeClass('moe-ngiht-btn');$('#nightBtn').addClass('moe-day-btn');$('#nightBtn').attr('onclick','NightSwitchOFF()')};window.NightSwitchOFF=function(){$('body').removeClass('mdui-theme-layout-dark');document.cookie="nightSwitch=; expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";document.getElementById('nightText').innerHTML='brightness_4';$('#nightBtn').attr('mdui-tooltip',"{content: '切换到夜间模式'}");$('#nightBtn').removeClass('moe-day-btn');$('#nightBtn').addClass('moe-ngiht-btn');$('#nightBtn').attr('onclick','NightSwitchON()')}}};checkNight=function(){function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(name)==0)return c.substring(name.length,c.length)}return false}if(getCookie('nightSwitch')=='open'){$('body').addClass('mdui-theme-layout-dark');document.getElementById('nightText').innerHTML='brightness_high';$('#nightBtn').attr('mdui-tooltip',"{content: '切换到日间模式'}");$('#nightBtn').removeClass('moe-ngiht-btn');$('#nightBtn').addClass('moe-day-btn');$('#nightBtn').attr('onclick','NightSwitchOFF()')}};checkNight();lazyreload=function(){$("img:not(.moe-links-main img)").lazyload({effect:"fadeIn"});$("main:not(.moe-links-main main)").lazyload({effect:"fadeIn"});$("#moe-s-links img").lazyload({effect:"fadeIn",container:$(".moe-links-main")});$("#moe-s-links main").lazyload({effect:"fadeIn",container:$(".moe-links-main")})};lazyreload();function commentLinks(){var LinksGet=document.getElementById("LinksX");var ID=document.getElementById("moe-input-url");if(LinksGet.value=='false'){document.getElementById("LinksX").value="true";ID.style.cssText="display: block;"}else if(LinksGet.value=='true'){document.getElementById("LinksX").value="false";ID.style.cssText="display: none;"}};function checkLast(node){next=$(node).next();if(next[0]==null){return node}if(next.hasClass("comment-list")==false){return node}nextNodeList=next.children(".moe-comments-list-li");nextNode=nextNodeList[nextNodeList.length-1];return checkLast(nextNode)};function getLastComment(){firstNodeList=$("#comments > ol > .moe-comments-list-li");if(firstNodeList.length==0){return null}firstNode=firstNodeList[firstNodeList.length-1];return checkLast(firstNode)};commentsHS=function(){window.TypechoComment={dom:function(id){return document.getElementById(id)},create:function(tag,attr){var el=document.createElement(tag);for(var key in attr){el.setAttribute(key,attr[key])}return el},reply:function(cid,coid){var comment=this.dom(cid),parent=comment.parentNode,response=this.dom(commentID),input=this.dom('comment-parent'),form='form'==response.tagName?response:response.getElementsByTagName('form')[0],textarea=response.getElementsByTagName('textarea')[0];if(null==input){input=this.create('input',{'type':'hidden','name':'parent','id':'comment-parent'});form.appendChild(input)}input.setAttribute('value',coid);if(null==this.dom('comment-form-place-holder')){var holder=this.create('div',{'id':'comment-form-place-holder'});response.parentNode.insertBefore(holder,response)}last=getLastComment();if(last==null){comment.appendChild(response)}else if(last.id==cid){$("#comments")[0].appendChild(response)}else{comment.appendChild(response)}this.dom('cancel-comment-reply-link').style.display='';if(null!=textarea&&'text'==textarea.name){textarea.focus()}return false},cancelReply:function(){var response=this.dom(commentID),holder=this.dom('comment-form-place-holder'),input=this.dom('comment-parent');if(null!=input){input.parentNode.removeChild(input)}if(null==holder){return true}this.dom('cancel-comment-reply-link').style.display='none';holder.parentNode.insertBefore(response,holder);return false}}};commentsHS();headimgAJAX=function(){$("#moe-comment-ajax-email").blur(function(){var email=$(this).val();var host=window.location.host;if(email!=""){$.ajax({type:"GET",data:{action:"ajax_avatar_get",form:host,email:email},success:function(src){$(".moe-comment-ajax-headimg").attr("src",src)}})}return false})};headimgAJAX();Searchclose=function(){var inst=new mdui.Dialog('#search-dialog');var status=inst.getState();inst.close()};Searchclose();SerachSubmit=function(){var searchB=$("#searchInput").val();var searchURL=siteurl+"index.php/search/"+searchB;$.pjax({url:searchURL,container:'#moe-body',fragment:'#moe-body',timeout:PJAXtimeout})};checkLink=function(){$('a:not(a[href="#"],a[no-go])').each(function(){var href=$(this).attr('href');var notarget=$(this).attr('data-fancybox');var siteLink=siteurl;var check=new RegExp("^"+siteLink);if(check.test(href)){return true}else{if(notarget=='images'){return true}else{$(this).attr('target','_blank')}}})};checkLink();rmTooltip=function(){$(".mdui-tooltip").removeClass("mdui-tooltip-open")};rmTooltip();function openLinksAN(){document.cookie="links=true";$('#moe-s-links').attr('style','display: block;');$('#moe-s-links').addClass('moe-links-comment-open')};function closeLinksAN(){document.cookie="links=; expires=Thu, 01 Jan 1970 00:00:00 GMT";$('#moe-s-links').removeClass('moe-links-comment-open');$('#moe-s-links').addClass('moe-links-comment-off');setTimeout(function(){$('#moe-s-links').attr('style','display: none;');$('#moe-s-links').removeClass('moe-links-comment-off')},210)};function openLinks(){$('#linkStatus').attr({"value":"true"});$('#moe-s-links').attr('style','display: block;');$('#moe-s-links').addClass('moe-links-comment-open')};function closeLinks(){$('#linkStatus').attr({"value":"false"});$('#moe-s-links').removeClass('moe-links-comment-open');$('#moe-s-links').addClass('moe-links-comment-off');setTimeout(function(){$('#moe-s-links').attr('style','display: none;');$('#moe-s-links').removeClass('moe-links-comment-off')},210)};checkLinks=function(){var status=$("#linkStatus").val();if(status=="true"){$('#moe-s-links').attr('style','display: block;');$('#moe-s-links').addClass('moe-links-comment-open-pjax')}};scrollClick=function(){$('a[href*="#"]:not(a[no-pgo]),area[href*="#"]:not(area[no-pgo])').click(function(){if(location.pathname.replace(/^\//,'')==this.pathname.replace(/^\//,'')&&location.hostname==this.hostname){var $target=$(this.hash);$target=$target.length&&$target||$('[name='+this.hash.slice(1)+']');if($target.length){var targetOffset=$target.offset().top;$('html,body').animate({scrollTop:targetOffset},600);return false}}})};scrollClick();bangumiNew=function(){var id=$("#bgmBox").data("id");var key=$("#bgmBox").data("key");if(String(id)!='undefined'&&String(key)!='undefined'){var bgmID=bgmURL.replace(':id',$("#bgmBox").data("id"));var bgmAuth=bgmID.replace(':auth',$("#bgmBox").data("key"));$.ajax({url:bgmAuth,type:'GET',timeout:15000,dataType:'json',success:function(data){if(data!='null'){$("#bgmLoad").attr('style','display: none');$("#bgmBox").addClass('moe-card-a');$.each(data,function(i,bgm){let html='<div class="mdui-col"><a href="'+bgm.url+'" target="_blank" title="'+bgm.name+'"><div class="mdui-card mdui-hoverable"><div class="mdui-card-header"><main class="moe-bgm-fimg" style="background-image: url('+bgm.img+');"></main><div class="moe-bgm-info"><div class="mdui-card-header-title">'+bgm.CNname+'</div><div class="mdui-card-header-subtitle">'+bgm.name+'</div><div class="mdui-progress moe-bgm-pr"><div class="mdui-progress-determinate" style="width: '+bgm.percentage+'%;"></div><span class="moe-bgm-c-t">'+bgm.status+' / '+bgm.count+'</span></div></div></div></div></a></div>';$("#bgmBox").append(html)})}else{$("#bgmLoad").attr('style','display: none');$("#bgmBox").append('<span class="moe-bgm-error moe-card-a">获取失败</span>')}},error:function(err){$("#bgmLoad").attr('style','display: none');$("#bgmBox").append('<span class="moe-bgm-error moe-card-a">获取失败</span>')},complete:function(XMLHttpRequest,status){if(status=='timeout'){$("#bgmLoad").attr('style','display: none');$("#bgmBox").append('<span class="moe-bgm-error moe-card-a">API请求超时</span>')}}})}};bangumiNew();RLhighlight=function(){$(document).ready(function(){$('pre code').each(function(i,block){hljs.highlightBlock(block)})});$("pre code").each(function(){$(this).html("<ol><li>"+$(this).html().replace(/\n/g,"\n</li><li>")+"\n</li></ol>")})};RLhighlight();console.log(" %c \u0043\u0061\u0073\u0074\u006c\u0065 "+themeVer+" %c \u0042\u0079\u0020\u006f\u0068\u006d\u0079\u0067\u0061\u0020\u007c\u0020\u0068\u0074\u0074\u0070\u0073\u003a\u002f\u002f\u006f\u0068\u006d\u0079\u0067\u0061\u002e\u0063\u006e\u002f ","color: #FFFFFF; background: #E91E63; padding:6px;","color: #FFFFFF; background: #757575; padding:6px;");window.onload=function(){var now=new Date().getTime();var page_load_time=now-performance.timing.navigationStart;console.log('%c\u9875\u9762\u52a0\u8f7d\u5b8c\u6bd5\u6d88\u8017\u4e86'+Math.round(performance.now()*100)/100+'\u006d\u0073','background: #fff;color: #333;text-shadow: 0 0 2px #eee, 0 0 3px #eee, 0 0 3px #eee, 0 0 2px #eee, 0 0 3px #eee;')};